services:
  # One-off execution: Run the bot once and exit
  # Usage: docker compose run --rm mastodon-bot
  mastodon-bot:
    build: .
    image: mastodon-bot:latest
    container_name: mastodon-bot
    volumes:
      # Mount your config file (required)
      - ./config.yaml:/app/config.yaml:ro
      # Mount your secrets file (required)
      - ./secrets.yaml:/app/secrets.yaml:ro
      # Mount your media directory (required)
      - ./media:/app/media:ro
      # Persist visited database (will be created automatically on first run)
      # Mount as a bind mount to persist in current directory
      - ./visited.pickledb:/app/visited.pickledb
      # Uncomment if you have an info database file:
      # - ./info.pickledb:/app/info.pickledb:ro
    environment:
      # Optional: Override config values with environment variables if needed
      - TZ=UTC
    restart: "no"
    profiles:
      - manual

  # Scheduled execution: Run the bot on a recurring schedule
  # Usage: docker compose up -d mastodon-bot-scheduled
  mastodon-bot-scheduled:
    build: .
    image: mastodon-bot:latest
    container_name: mastodon-bot-scheduled
    entrypoint: ["/app/scheduler.sh"]
    volumes:
      # Mount your config file (required)
      - ./config.yaml:/app/config.yaml:ro
      # Mount your secrets file (required)
      - ./secrets.yaml:/app/secrets.yaml:ro
      # Mount your media directory (required)
      - ./media:/app/media:ro
      # Persist visited database (will be created automatically on first run)
      # Mount as a bind mount to persist in current directory
      - ./visited.pickledb:/app/visited.pickledb
      # Uncomment if you have an info database file:
      # - ./info.pickledb:/app/info.pickledb:ro
    environment:
      # Optional: Override config values with environment variables if needed
      - TZ=UTC
      # Schedule interval: Xs (seconds), Xm (minutes), Xh (hours), Xd (days)
      # Default: 4h (4 hours)
      - SCHEDULE_INTERVAL=4h
    restart: unless-stopped
